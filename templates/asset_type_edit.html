{% extends "base.html" %}
{% block content %}
  <div class="card" style="max-width: 820px;">
    <h2>Edit Asset Type</h2>
    <form method="post" class="form-grid">
      <div>
        <label for="label">Display Label</label>
        <input id="label" name="label" type="text" value="{{ asset_type.label }}" required>
      </div>
      <div>
        <label>Key</label>
        <input type="text" value="{{ asset_type.key }}" disabled>
      </div>
      <div>
        <label>Existing Fields</label>
        {% for field in fields %}
          <div class="field-row" style="margin-top: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 160px; gap: 10px;">
              <input type="text" value="{{ field.name }}" disabled>
              <input name="field_label_{{ field.id }}" type="text" value="{{ field.label }}">
              <select name="field_type_{{ field.id }}" class="field-type-select">
                <option value="text" {% if field.field_type == 'text' %}selected{% endif %}>Text</option>
                <option value="checkbox" {% if field.field_type == 'checkbox' %}selected{% endif %}>Checkbox</option>
                <option value="select" {% if field.field_type == 'select' %}selected{% endif %}>Select</option>
              </select>
            </div>
            <div class="field-options" style="display: none; margin-top: 8px;">
              <div class="muted" style="font-size: 13px;">Options for checkbox/select (leave blank for true/false or empty select)</div>
              <div style="display: grid; grid-template-columns: repeat(3, minmax(120px, 1fr)); gap: 8px; margin-top: 6px;">
                {% for opt_idx in range(1, 6) %}
                  {% set opt_value = field.options[opt_idx - 1] if field.options and field.options|length >= opt_idx else '' %}
                  <input name="field_options_{{ field.id }}_{{ opt_idx }}" type="text" placeholder="Option {{ opt_idx }}" value="{{ opt_value }}">
                {% endfor %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div>
        <label>Add New Fields</label>
        {% for idx in range(1, 6) %}
          <div class="field-row" style="margin-top: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 160px; gap: 10px;">
              <input name="new_field_name_{{ idx }}" type="text" placeholder="field_name">
              <input name="new_field_label_{{ idx }}" type="text" placeholder="Field Label">
              <select name="new_field_type_{{ idx }}" class="field-type-select">
                <option value="text">Text</option>
                <option value="checkbox">Checkbox</option>
                <option value="select">Select</option>
              </select>
            </div>
            <div class="field-options" style="display: none; margin-top: 8px;">
              <div class="muted" style="font-size: 13px;">Options for checkbox/select (leave blank for true/false or empty select)</div>
              <div style="display: grid; grid-template-columns: repeat(3, minmax(120px, 1fr)); gap: 8px; margin-top: 6px;">
                {% for opt_idx in range(1, 6) %}
                  <input name="new_field_options_{{ idx }}_{{ opt_idx }}" type="text" placeholder="Option {{ opt_idx }}">
                {% endfor %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <button class="button" type="submit">Save</button>
      <a class="button secondary" href="{{ url_for('list_asset_types') }}">Cancel</a>
    </form>
    <script>
      const rows = document.querySelectorAll('.field-row');
      rows.forEach((row) => {
        const select = row.querySelector('.field-type-select');
        const options = row.querySelector('.field-options');
        if (!select || !options) return;
        const toggle = () => {
          if (select.value === 'checkbox' || select.value === 'select') {
            options.style.display = 'block';
          } else {
            options.style.display = 'none';
          }
        };
        select.addEventListener('change', toggle);
        toggle();
      });
    </script>
  </div>
{% endblock %}
